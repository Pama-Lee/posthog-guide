"use strict";(self.webpackChunkposthog_guide=self.webpackChunkposthog_guide||[]).push([[6405],{90042:(n,e,l)=>{l.r(e),l.d(e,{assets:()=>h,contentTitle:()=>c,default:()=>t,frontMatter:()=>d,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"\ud83d\udce1 \u6355\u83b7\u670d\u52a1/deployment","title":"PostHog Capture \u90e8\u7f72\u6307\u5357","description":"\u73af\u5883\u8981\u6c42","source":"@site/docs/\ud83d\udce1 \u6355\u83b7\u670d\u52a1/deployment.md","sourceDirName":"\ud83d\udce1 \u6355\u83b7\u670d\u52a1","slug":"/\ud83d\udce1 \u6355\u83b7\u670d\u52a1/deployment","permalink":"/posthog-guide/docs/\ud83d\udce1 \u6355\u83b7\u670d\u52a1/deployment","draft":false,"unlisted":false,"editUrl":"https://github.com/pama-lee/posthog-guide/tree/main/docs/\ud83d\udce1 \u6355\u83b7\u670d\u52a1/deployment.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"PostHog Capture \u914d\u7f6e\u8bf4\u660e","permalink":"/posthog-guide/docs/\ud83d\udce1 \u6355\u83b7\u670d\u52a1/configuration"},"next":{"title":"PostHog Capture \u76d1\u63a7\u6307\u6807","permalink":"/posthog-guide/docs/\ud83d\udce1 \u6355\u83b7\u670d\u52a1/metrics"}}');var i=l(74848),r=l(28453);const d={},c="PostHog Capture \u90e8\u7f72\u6307\u5357",h={},o=[{value:"\u73af\u5883\u8981\u6c42",id:"\u73af\u5883\u8981\u6c42",level:2},{value:"\u7cfb\u7edf\u8981\u6c42",id:"\u7cfb\u7edf\u8981\u6c42",level:3},{value:"\u4f9d\u8d56\u670d\u52a1",id:"\u4f9d\u8d56\u670d\u52a1",level:3},{value:"\u90e8\u7f72\u6b65\u9aa4",id:"\u90e8\u7f72\u6b65\u9aa4",level:2},{value:"1. \u51c6\u5907\u5de5\u4f5c",id:"1-\u51c6\u5907\u5de5\u4f5c",level:3},{value:"2. \u914d\u7f6e\u670d\u52a1",id:"2-\u914d\u7f6e\u670d\u52a1",level:3},{value:"3. \u6784\u5efa\u670d\u52a1",id:"3-\u6784\u5efa\u670d\u52a1",level:3},{value:"4. \u8fd0\u884c\u670d\u52a1",id:"4-\u8fd0\u884c\u670d\u52a1",level:3},{value:"5. \u9a8c\u8bc1\u90e8\u7f72",id:"5-\u9a8c\u8bc1\u90e8\u7f72",level:3},{value:"\u76d1\u63a7\u8bbe\u7f6e",id:"\u76d1\u63a7\u8bbe\u7f6e",level:2},{value:"1. Prometheus \u914d\u7f6e",id:"1-prometheus-\u914d\u7f6e",level:3},{value:"2. Grafana \u8bbe\u7f6e",id:"2-grafana-\u8bbe\u7f6e",level:3},{value:"\u8fd0\u7ef4\u5efa\u8bae",id:"\u8fd0\u7ef4\u5efa\u8bae",level:2},{value:"1. \u65e5\u5fd7\u7ba1\u7406",id:"1-\u65e5\u5fd7\u7ba1\u7406",level:3},{value:"2. \u5907\u4efd\u7b56\u7565",id:"2-\u5907\u4efd\u7b56\u7565",level:3},{value:"3. \u6269\u5c55\u6027\u5efa\u8bae",id:"3-\u6269\u5c55\u6027\u5efa\u8bae",level:3},{value:"4. \u5b89\u5168\u5efa\u8bae",id:"4-\u5b89\u5168\u5efa\u8bae",level:3},{value:"\u6545\u969c\u6392\u9664",id:"\u6545\u969c\u6392\u9664",level:2},{value:"\u5e38\u89c1\u95ee\u9898",id:"\u5e38\u89c1\u95ee\u9898",level:3},{value:"\u8c03\u8bd5\u5de5\u5177",id:"\u8c03\u8bd5\u5de5\u5177",level:3}];function a(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"posthog-capture-\u90e8\u7f72\u6307\u5357",children:"PostHog Capture \u90e8\u7f72\u6307\u5357"})}),"\n",(0,i.jsx)(e.h2,{id:"\u73af\u5883\u8981\u6c42",children:"\u73af\u5883\u8981\u6c42"}),"\n",(0,i.jsx)(e.h3,{id:"\u7cfb\u7edf\u8981\u6c42",children:"\u7cfb\u7edf\u8981\u6c42"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u64cd\u4f5c\u7cfb\u7edf\uff1aLinux/Unix"}),"\n",(0,i.jsx)(e.li,{children:"CPU\uff1a2+ \u6838\u5fc3"}),"\n",(0,i.jsx)(e.li,{children:"\u5185\u5b58\uff1a4GB+"}),"\n",(0,i.jsx)(e.li,{children:"\u78c1\u76d8\uff1a20GB+"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u4f9d\u8d56\u670d\u52a1",children:"\u4f9d\u8d56\u670d\u52a1"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Kafka 2.8+"}),"\n",(0,i.jsx)(e.li,{children:"Redis 6.0+"}),"\n",(0,i.jsx)(e.li,{children:"Prometheus\uff08\u53ef\u9009\uff0c\u7528\u4e8e\u76d1\u63a7\uff09"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"\u90e8\u7f72\u6b65\u9aa4",children:"\u90e8\u7f72\u6b65\u9aa4"}),"\n",(0,i.jsx)(e.h3,{id:"1-\u51c6\u5907\u5de5\u4f5c",children:"1. \u51c6\u5907\u5de5\u4f5c"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u5b89\u88c5 Go \u73af\u5883"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"wget https://go.dev/dl/go1.21.0.linux-amd64.tar.gz\ntar -C /usr/local -xzf go1.21.0.linux-amd64.tar.gz\nexport PATH=$PATH:/usr/local/go/bin\n"})}),"\n",(0,i.jsxs)(e.ol,{start:"2",children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u83b7\u53d6\u6e90\u4ee3\u7801"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"git clone <repository_url>\ncd capture\n"})}),"\n",(0,i.jsxs)(e.ol,{start:"3",children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u5b89\u88c5\u4f9d\u8d56"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"go mod download\ngo mod verify\n"})}),"\n",(0,i.jsx)(e.h3,{id:"2-\u914d\u7f6e\u670d\u52a1",children:"2. \u914d\u7f6e\u670d\u52a1"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u521b\u5efa\u914d\u7f6e\u6587\u4ef6"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"cp config.example.json config.json\n"})}),"\n",(0,i.jsxs)(e.ol,{start:"2",children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u4fee\u6539\u914d\u7f6e"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n    "port": 8000,\n    "kafka_brokers": ["kafka1:9092", "kafka2:9092"],\n    "kafka_topics": {\n        "events_plugin_ingestion": "events_plugin_ingestion",\n        "session_recordings": "session_recordings"\n    },\n    "redis_addr": "redis:6379",\n    "redis_password": "your_password",\n    "redis_db": 0,\n    "max_request_size": 20,\n    "max_event_size": 20971520\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"3-\u6784\u5efa\u670d\u52a1",children:"3. \u6784\u5efa\u670d\u52a1"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u672c\u5730\u6784\u5efa"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"go build -o capture\n"})}),"\n",(0,i.jsxs)(e.ol,{start:"2",children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"Docker \u6784\u5efa"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"docker build -t posthog-capture .\n"})}),"\n",(0,i.jsx)(e.h3,{id:"4-\u8fd0\u884c\u670d\u52a1",children:"4. \u8fd0\u884c\u670d\u52a1"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u76f4\u63a5\u8fd0\u884c"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"./capture -config config.json\n"})}),"\n",(0,i.jsxs)(e.ol,{start:"2",children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u4f7f\u7528 Docker \u8fd0\u884c"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"docker run -d \\\n    --name posthog-capture \\\n    -p 8000:8000 \\\n    -v $(pwd)/config.json:/app/config.json \\\n    posthog-capture\n"})}),"\n",(0,i.jsxs)(e.ol,{start:"3",children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u4f7f\u7528 Docker Compose"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"version: '3'\nservices:\n  capture:\n    image: posthog-capture\n    ports:\n      - \"8000:8000\"\n    volumes:\n      - ./config.json:/app/config.json\n    depends_on:\n      - kafka\n      - redis\n"})}),"\n",(0,i.jsx)(e.h3,{id:"5-\u9a8c\u8bc1\u90e8\u7f72",children:"5. \u9a8c\u8bc1\u90e8\u7f72"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u5065\u5eb7\u68c0\u67e5"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"curl http://localhost:8000/_readiness\ncurl http://localhost:8000/_liveness\n"})}),"\n",(0,i.jsxs)(e.ol,{start:"2",children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u53d1\u9001\u6d4b\u8bd5\u4e8b\u4ef6"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'curl -X POST http://localhost:8000/e/ \\\n    -H "Content-Type: application/json" \\\n    -d \'{\n        "event": "test_event",\n        "properties": {\n            "distinct_id": "test_user"\n        }\n    }\'\n'})}),"\n",(0,i.jsx)(e.h2,{id:"\u76d1\u63a7\u8bbe\u7f6e",children:"\u76d1\u63a7\u8bbe\u7f6e"}),"\n",(0,i.jsx)(e.h3,{id:"1-prometheus-\u914d\u7f6e",children:"1. Prometheus \u914d\u7f6e"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"scrape_configs:\n  - job_name: 'posthog-capture'\n    static_configs:\n      - targets: ['localhost:8000']\n    metrics_path: '/metrics'\n"})}),"\n",(0,i.jsx)(e.h3,{id:"2-grafana-\u8bbe\u7f6e",children:"2. Grafana \u8bbe\u7f6e"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u6dfb\u52a0 Prometheus \u6570\u636e\u6e90"}),"\n",(0,i.jsx)(e.li,{children:"\u5bfc\u5165\u63a8\u8350\u7684\u4eea\u8868\u677f"}),"\n",(0,i.jsx)(e.li,{children:"\u914d\u7f6e\u544a\u8b66\u89c4\u5219"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"\u8fd0\u7ef4\u5efa\u8bae",children:"\u8fd0\u7ef4\u5efa\u8bae"}),"\n",(0,i.jsx)(e.h3,{id:"1-\u65e5\u5fd7\u7ba1\u7406",children:"1. \u65e5\u5fd7\u7ba1\u7406"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4f7f\u7528 logrotate \u7ba1\u7406\u65e5\u5fd7\u6587\u4ef6"}),"\n",(0,i.jsx)(e.li,{children:"\u914d\u7f6e\u9002\u5f53\u7684\u65e5\u5fd7\u7ea7\u522b"}),"\n",(0,i.jsx)(e.li,{children:"\u5b9a\u671f\u6e05\u7406\u65e7\u65e5\u5fd7"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"2-\u5907\u4efd\u7b56\u7565",children:"2. \u5907\u4efd\u7b56\u7565"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5b9a\u671f\u5907\u4efd\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,i.jsx)(e.li,{children:"\u4fdd\u5b58 Kafka \u6d88\u606f\u526f\u672c"}),"\n",(0,i.jsx)(e.li,{children:"\u5907\u4efd Redis \u6570\u636e"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"3-\u6269\u5c55\u6027\u5efa\u8bae",children:"3. \u6269\u5c55\u6027\u5efa\u8bae"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4f7f\u7528\u8d1f\u8f7d\u5747\u8861\u5668\u5206\u53d1\u6d41\u91cf"}),"\n",(0,i.jsx)(e.li,{children:"\u914d\u7f6e\u591a\u4e2a\u670d\u52a1\u5b9e\u4f8b"}),"\n",(0,i.jsx)(e.li,{children:"\u76d1\u63a7\u7cfb\u7edf\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"4-\u5b89\u5168\u5efa\u8bae",children:"4. \u5b89\u5168\u5efa\u8bae"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7f51\u7edc\u5b89\u5168"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u914d\u7f6e\u9632\u706b\u5899\u89c4\u5219"}),"\n",(0,i.jsx)(e.li,{children:"\u4f7f\u7528 HTTPS"}),"\n",(0,i.jsx)(e.li,{children:"\u9650\u5236\u8bbf\u95ee\u6765\u6e90"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u8ba4\u8bc1\u5b89\u5168"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4f7f\u7528\u5f3a\u5bc6\u7801"}),"\n",(0,i.jsx)(e.li,{children:"\u5b9a\u671f\u8f6e\u6362\u5bc6\u94a5"}),"\n",(0,i.jsx)(e.li,{children:"\u9650\u5236\u8bbf\u95ee\u6743\u9650"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7cfb\u7edf\u5b89\u5168"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u53ca\u65f6\u66f4\u65b0\u7cfb\u7edf"}),"\n",(0,i.jsx)(e.li,{children:"\u6700\u5c0f\u6743\u9650\u539f\u5219"}),"\n",(0,i.jsx)(e.li,{children:"\u5b9a\u671f\u5b89\u5168\u5ba1\u8ba1"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"\u6545\u969c\u6392\u9664",children:"\u6545\u969c\u6392\u9664"}),"\n",(0,i.jsx)(e.h3,{id:"\u5e38\u89c1\u95ee\u9898",children:"\u5e38\u89c1\u95ee\u9898"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u670d\u52a1\u65e0\u6cd5\u542f\u52a8"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u68c0\u67e5\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,i.jsx)(e.li,{children:"\u9a8c\u8bc1\u4f9d\u8d56\u670d\u52a1\u72b6\u6001"}),"\n",(0,i.jsx)(e.li,{children:"\u67e5\u770b\u9519\u8bef\u65e5\u5fd7"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6027\u80fd\u95ee\u9898"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u68c0\u67e5\u7cfb\u7edf\u8d44\u6e90"}),"\n",(0,i.jsx)(e.li,{children:"\u4f18\u5316\u914d\u7f6e\u53c2\u6570"}),"\n",(0,i.jsx)(e.li,{children:"\u5206\u6790\u76d1\u63a7\u6307\u6807"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u8fde\u63a5\u95ee\u9898"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u9a8c\u8bc1\u7f51\u7edc\u8fde\u63a5"}),"\n",(0,i.jsx)(e.li,{children:"\u68c0\u67e5\u9632\u706b\u5899\u89c4\u5219"}),"\n",(0,i.jsx)(e.li,{children:"\u6d4b\u8bd5\u4f9d\u8d56\u670d\u52a1"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u8c03\u8bd5\u5de5\u5177",children:"\u8c03\u8bd5\u5de5\u5177"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u65e5\u5fd7\u67e5\u770b"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"tail -f /var/log/capture.log\n"})}),"\n",(0,i.jsxs)(e.ol,{start:"2",children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u6307\u6807\u67e5\u8be2"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"curl http://localhost:8000/metrics\n"})}),"\n",(0,i.jsxs)(e.ol,{start:"3",children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u6027\u80fd\u5206\u6790"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"go tool pprof http://localhost:8000/debug/pprof/profile\n"})})]})}function t(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(a,{...n})}):a(n)}},28453:(n,e,l)=>{l.d(e,{R:()=>d,x:()=>c});var s=l(96540);const i={},r=s.createContext(i);function d(n){const e=s.useContext(r);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:d(n.components),s.createElement(r.Provider,{value:e},n.children)}}}]);