"use strict";(self.webpackChunkposthog_guide=self.webpackChunkposthog_guide||[]).push([[9046],{86990:(n,e,l)=>{l.r(e),l.d(e,{assets:()=>t,contentTitle:()=>c,default:()=>x,frontMatter:()=>d,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"\ud83d\udce1 \u6355\u83b7\u670d\u52a1/metrics","title":"PostHog Capture \u76d1\u63a7\u6307\u6807","description":"Prometheus \u6307\u6807","source":"@site/docs/\ud83d\udce1 \u6355\u83b7\u670d\u52a1/metrics.md","sourceDirName":"\ud83d\udce1 \u6355\u83b7\u670d\u52a1","slug":"/\ud83d\udce1 \u6355\u83b7\u670d\u52a1/metrics","permalink":"/posthog-guide/docs/\ud83d\udce1 \u6355\u83b7\u670d\u52a1/metrics","draft":false,"unlisted":false,"editUrl":"https://github.com/pama-lee/posthog-guide/tree/main/docs/\ud83d\udce1 \u6355\u83b7\u670d\u52a1/metrics.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"PostHog Capture \u90e8\u7f72\u6307\u5357","permalink":"/posthog-guide/docs/\ud83d\udce1 \u6355\u83b7\u670d\u52a1/deployment"},"next":{"title":"\u2696\ufe0f \u8d1f\u8f7d\u5747\u8861\u4e0e\u8f6c\u53d1","permalink":"/posthog-guide/docs/category/\ufe0f-\u8d1f\u8f7d\u5747\u8861\u4e0e\u8f6c\u53d1"}}');var s=l(74848),i=l(28453);const d={},c="PostHog Capture \u76d1\u63a7\u6307\u6807",t={},h=[{value:"Prometheus \u6307\u6807",id:"prometheus-\u6307\u6807",level:2},{value:"\u4e8b\u4ef6\u76f8\u5173\u6307\u6807",id:"\u4e8b\u4ef6\u76f8\u5173\u6307\u6807",level:3},{value:"\u8bf7\u6c42\u5904\u7406\u6307\u6807",id:"\u8bf7\u6c42\u5904\u7406\u6307\u6807",level:3},{value:"Redis \u64cd\u4f5c\u6307\u6807",id:"redis-\u64cd\u4f5c\u6307\u6807",level:3},{value:"\u914d\u989d\u548c\u9650\u5236\u6307\u6807",id:"\u914d\u989d\u548c\u9650\u5236\u6307\u6807",level:3},{value:"\u5904\u7406\u9519\u8bef\u6307\u6807",id:"\u5904\u7406\u9519\u8bef\u6307\u6807",level:3},{value:"\u76d1\u63a7\u9762\u677f",id:"\u76d1\u63a7\u9762\u677f",level:2},{value:"\u63a8\u8350\u7684 Grafana \u9762\u677f\u914d\u7f6e",id:"\u63a8\u8350\u7684-grafana-\u9762\u677f\u914d\u7f6e",level:3},{value:"\u544a\u8b66\u89c4\u5219",id:"\u544a\u8b66\u89c4\u5219",level:2},{value:"\u5173\u952e\u544a\u8b66",id:"\u5173\u952e\u544a\u8b66",level:3},{value:"\u8b66\u544a\u7ea7\u522b\u544a\u8b66",id:"\u8b66\u544a\u7ea7\u522b\u544a\u8b66",level:3},{value:"\u76d1\u63a7\u6700\u4f73\u5b9e\u8df5",id:"\u76d1\u63a7\u6700\u4f73\u5b9e\u8df5",level:2}];function o(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"posthog-capture-\u76d1\u63a7\u6307\u6807",children:"PostHog Capture \u76d1\u63a7\u6307\u6807"})}),"\n",(0,s.jsx)(e.h2,{id:"prometheus-\u6307\u6807",children:"Prometheus \u6307\u6807"}),"\n",(0,s.jsx)(e.h3,{id:"\u4e8b\u4ef6\u76f8\u5173\u6307\u6807",children:"\u4e8b\u4ef6\u76f8\u5173\u6307\u6807"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"\u4e8b\u4ef6\u63a5\u6536\u8ba1\u6570"})}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'capture_events_received_total{type="<event_type>"}\n'})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7c7b\u578b\uff1aCounter"}),"\n",(0,s.jsxs)(e.li,{children:["\u6807\u7b7e\uff1a","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:'type: "event" \u6216 "recording"'}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"\u8bf4\u660e\uff1a\u63a5\u6536\u5230\u7684\u4e8b\u4ef6\u603b\u6570"}),"\n"]}),"\n",(0,s.jsxs)(e.ol,{start:"2",children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"\u4e8b\u4ef6\u4e22\u5f03\u8ba1\u6570"})}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'capture_events_dropped_total{cause="<cause>"}\n'})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7c7b\u578b\uff1aCounter"}),"\n",(0,s.jsxs)(e.li,{children:["\u6807\u7b7e\uff1a","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:'cause: \u4e22\u5f03\u539f\u56e0\uff08\u5982 "size_exceeded", "quota_limited" \u7b49\uff09'}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"\u8bf4\u660e\uff1a\u88ab\u4e22\u5f03\u7684\u4e8b\u4ef6\u6570\u91cf"}),"\n"]}),"\n",(0,s.jsxs)(e.ol,{start:"3",children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"\u4e8b\u4ef6\u5927\u5c0f\u5206\u5e03"})}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'capture_event_size_bytes{type="<event_type>"}\n'})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7c7b\u578b\uff1aHistogram"}),"\n",(0,s.jsxs)(e.li,{children:["\u6807\u7b7e\uff1a","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:'type: "event" \u6216 "recording"'}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"Buckets: [1024, 5120, 10240, 51200, 102400, 512000, 1048576, 5242880, 10485760]"}),"\n",(0,s.jsx)(e.li,{children:"\u8bf4\u660e\uff1a\u4e8b\u4ef6\u5927\u5c0f\u5206\u5e03\u60c5\u51b5"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"\u8bf7\u6c42\u5904\u7406\u6307\u6807",children:"\u8bf7\u6c42\u5904\u7406\u6307\u6807"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"\u8bf7\u6c42\u5904\u7406\u65f6\u95f4"})}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'capture_request_duration_seconds{path="<path>",method="<method>"}\n'})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7c7b\u578b\uff1aHistogram"}),"\n",(0,s.jsxs)(e.li,{children:["\u6807\u7b7e\uff1a","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"path: \u8bf7\u6c42\u8def\u5f84"}),"\n",(0,s.jsx)(e.li,{children:"method: HTTP \u65b9\u6cd5"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"\u8bf4\u660e\uff1a\u8bf7\u6c42\u5904\u7406\u8017\u65f6\u5206\u5e03"}),"\n"]}),"\n",(0,s.jsxs)(e.ol,{start:"2",children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"Kafka \u751f\u4ea7\u8005\u9519\u8bef"})}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"capture_kafka_producer_errors_total\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7c7b\u578b\uff1aCounter"}),"\n",(0,s.jsx)(e.li,{children:"\u8bf4\u660e\uff1aKafka \u751f\u4ea7\u8005\u9519\u8bef\u603b\u6570"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"redis-\u64cd\u4f5c\u6307\u6807",children:"Redis \u64cd\u4f5c\u6307\u6807"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"Redis \u64cd\u4f5c\u5ef6\u8fdf"})}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'capture_redis_operation_duration_seconds{operation="<operation>"}\n'})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7c7b\u578b\uff1aHistogram"}),"\n",(0,s.jsxs)(e.li,{children:["\u6807\u7b7e\uff1a","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"operation: \u64cd\u4f5c\u7c7b\u578b"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"\u8bf4\u660e\uff1aRedis \u64cd\u4f5c\u8017\u65f6\u5206\u5e03"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"\u914d\u989d\u548c\u9650\u5236\u6307\u6807",children:"\u914d\u989d\u548c\u9650\u5236\u6307\u6807"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"\u914d\u989d\u9650\u5236\u8ba1\u6570"})}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'capture_quota_limited_total{type="<type>",token="<token>"}\n'})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7c7b\u578b\uff1aCounter"}),"\n",(0,s.jsxs)(e.li,{children:["\u6807\u7b7e\uff1a","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"type: \u4e8b\u4ef6\u7c7b\u578b"}),"\n",(0,s.jsx)(e.li,{children:"token: API \u4ee4\u724c"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"\u8bf4\u660e\uff1a\u56e0\u914d\u989d\u9650\u5236\u800c\u88ab\u62d2\u7edd\u7684\u8bf7\u6c42\u6570"}),"\n"]}),"\n",(0,s.jsxs)(e.ol,{start:"2",children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"Token \u9a8c\u8bc1\u7ed3\u679c"})}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'capture_token_validation_total{result="<result>"}\n'})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7c7b\u578b\uff1aCounter"}),"\n",(0,s.jsxs)(e.li,{children:["\u6807\u7b7e\uff1a","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:'result: "success" \u6216 "failure"'}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"\u8bf4\u660e\uff1aToken \u9a8c\u8bc1\u7ed3\u679c\u7edf\u8ba1"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"\u5904\u7406\u9519\u8bef\u6307\u6807",children:"\u5904\u7406\u9519\u8bef\u6307\u6807"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"\u5904\u7406\u9519\u8bef\u8ba1\u6570"})}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'capture_processing_errors_total{type="<type>",error="<error>"}\n'})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7c7b\u578b\uff1aCounter"}),"\n",(0,s.jsxs)(e.li,{children:["\u6807\u7b7e\uff1a","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"type: \u4e8b\u4ef6\u7c7b\u578b"}),"\n",(0,s.jsx)(e.li,{children:"error: \u9519\u8bef\u7c7b\u578b"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:"\u8bf4\u660e\uff1a\u4e8b\u4ef6\u5904\u7406\u9519\u8bef\u7edf\u8ba1"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"\u76d1\u63a7\u9762\u677f",children:"\u76d1\u63a7\u9762\u677f"}),"\n",(0,s.jsx)(e.h3,{id:"\u63a8\u8350\u7684-grafana-\u9762\u677f\u914d\u7f6e",children:"\u63a8\u8350\u7684 Grafana \u9762\u677f\u914d\u7f6e"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"\u603b\u4f53\u6982\u89c8"})}),"\n"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u4e8b\u4ef6\u63a5\u6536\u901f\u7387"}),"\n",(0,s.jsx)(e.li,{children:"\u9519\u8bef\u7387"}),"\n",(0,s.jsx)(e.li,{children:"\u54cd\u5e94\u65f6\u95f4 P95/P99"}),"\n",(0,s.jsx)(e.li,{children:"\u914d\u989d\u9650\u5236\u60c5\u51b5"}),"\n"]}),"\n",(0,s.jsxs)(e.ol,{start:"2",children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"\u6027\u80fd\u76d1\u63a7"})}),"\n"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Redis \u64cd\u4f5c\u5ef6\u8fdf"}),"\n",(0,s.jsx)(e.li,{children:"Kafka \u751f\u4ea7\u5ef6\u8fdf"}),"\n",(0,s.jsx)(e.li,{children:"\u8bf7\u6c42\u5904\u7406\u65f6\u95f4\u5206\u5e03"}),"\n",(0,s.jsx)(e.li,{children:"\u4e8b\u4ef6\u5927\u5c0f\u5206\u5e03"}),"\n"]}),"\n",(0,s.jsxs)(e.ol,{start:"3",children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"\u9519\u8bef\u8ffd\u8e2a"})}),"\n"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5404\u7c7b\u9519\u8bef\u6570\u91cf"}),"\n",(0,s.jsx)(e.li,{children:"Token \u9a8c\u8bc1\u5931\u8d25\u7387"}),"\n",(0,s.jsx)(e.li,{children:"Kafka \u9519\u8bef\u7387"}),"\n",(0,s.jsx)(e.li,{children:"Redis \u9519\u8bef\u7387"}),"\n"]}),"\n",(0,s.jsxs)(e.ol,{start:"4",children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"\u5bb9\u91cf\u89c4\u5212"})}),"\n"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u4e8b\u4ef6\u541e\u5410\u91cf\u8d8b\u52bf"}),"\n",(0,s.jsx)(e.li,{children:"\u5b58\u50a8\u4f7f\u7528\u8d8b\u52bf"}),"\n",(0,s.jsx)(e.li,{children:"\u914d\u989d\u4f7f\u7528\u60c5\u51b5"}),"\n",(0,s.jsx)(e.li,{children:"\u8d44\u6e90\u4f7f\u7528\u7387"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"\u544a\u8b66\u89c4\u5219",children:"\u544a\u8b66\u89c4\u5219"}),"\n",(0,s.jsx)(e.h3,{id:"\u5173\u952e\u544a\u8b66",children:"\u5173\u952e\u544a\u8b66"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"\u9ad8\u9519\u8bef\u7387"})}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"rate(capture_processing_errors_total[5m]) > 0.1\n"})}),"\n",(0,s.jsxs)(e.ol,{start:"2",children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"\u9ad8\u5ef6\u8fdf"})}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"histogram_quantile(0.95, rate(capture_request_duration_seconds_bucket[5m])) > 1\n"})}),"\n",(0,s.jsxs)(e.ol,{start:"3",children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"Kafka \u9519\u8bef"})}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"rate(capture_kafka_producer_errors_total[5m]) > 0\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u8b66\u544a\u7ea7\u522b\u544a\u8b66",children:"\u8b66\u544a\u7ea7\u522b\u544a\u8b66"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"\u914d\u989d\u9650\u5236\u589e\u52a0"})}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"rate(capture_quota_limited_total[1h]) > rate(capture_quota_limited_total[1h] offset 1h)\n"})}),"\n",(0,s.jsxs)(e.ol,{start:"2",children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"\u4e8b\u4ef6\u4e22\u5f03\u7387\u9ad8"})}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"rate(capture_events_dropped_total[5m]) / rate(capture_events_received_total[5m]) > 0.05\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u76d1\u63a7\u6700\u4f73\u5b9e\u8df5",children:"\u76d1\u63a7\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"\u6570\u636e\u4fdd\u7559"})}),"\n"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u539f\u59cb\u6307\u6807\u6570\u636e\u4fdd\u7559 15 \u5929"}),"\n",(0,s.jsx)(e.li,{children:"\u805a\u5408\u6570\u636e\u4fdd\u7559 90 \u5929"}),"\n",(0,s.jsx)(e.li,{children:"\u91cd\u8981\u4e8b\u4ef6\u6c38\u4e45\u5b58\u50a8"}),"\n"]}),"\n",(0,s.jsxs)(e.ol,{start:"2",children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"\u91c7\u6837\u7387"})}),"\n"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u4e00\u822c\u6307\u6807 15s \u91c7\u6837"}),"\n",(0,s.jsx)(e.li,{children:"\u8be6\u7ec6\u6307\u6807 1min \u91c7\u6837"}),"\n",(0,s.jsx)(e.li,{children:"\u957f\u671f\u8d8b\u52bf 5min \u91c7\u6837"}),"\n"]}),"\n",(0,s.jsxs)(e.ol,{start:"3",children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"\u544a\u8b66\u914d\u7f6e"})}),"\n"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u8bbe\u7f6e\u5408\u9002\u7684\u544a\u8b66\u9608\u503c"}),"\n",(0,s.jsx)(e.li,{children:"\u914d\u7f6e\u544a\u8b66\u5347\u7ea7\u673a\u5236"}),"\n",(0,s.jsx)(e.li,{children:"\u5efa\u7acb\u544a\u8b66\u54cd\u5e94\u6d41\u7a0b"}),"\n",(0,s.jsx)(e.li,{children:"\u5b9a\u671f\u5ba1\u67e5\u544a\u8b66\u89c4\u5219"}),"\n"]})]})}function x(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(o,{...n})}):o(n)}},28453:(n,e,l)=>{l.d(e,{R:()=>d,x:()=>c});var r=l(96540);const s={},i=r.createContext(s);function d(n){const e=r.useContext(i);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:d(n.components),r.createElement(i.Provider,{value:e},n.children)}}}]);