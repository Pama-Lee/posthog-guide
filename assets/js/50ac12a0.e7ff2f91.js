"use strict";(self.webpackChunkposthog_guide=self.webpackChunkposthog_guide||[]).push([[8038],{60160:(e,d,r)=>{r.r(d),r.d(d,{assets:()=>t,contentTitle:()=>c,default:()=>x,frontMatter:()=>l,metadata:()=>n,toc:()=>h});const n=JSON.parse('{"id":"\ud83d\udd0d HogQL/expressions","title":"HogQL \u8868\u8fbe\u5f0f\u6307\u5357","description":"\u8868\u8fbe\u5f0f\u6982\u8ff0","source":"@site/docs/\ud83d\udd0d HogQL/expressions.md","sourceDirName":"\ud83d\udd0d HogQL","slug":"/\ud83d\udd0d HogQL/expressions","permalink":"/posthog-guide/docs/\ud83d\udd0d HogQL/expressions","draft":false,"unlisted":false,"editUrl":"https://github.com/pama-lee/posthog-guide/tree/main/docs/\ud83d\udd0d HogQL/expressions.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"HogQL \u805a\u5408\u51fd\u6570","permalink":"/posthog-guide/docs/\ud83d\udd0d HogQL/aggregations"},"next":{"title":"HogQL \u7b80\u4ecb","permalink":"/posthog-guide/docs/\ud83d\udd0d HogQL/introduction"}}');var s=r(74848),i=r(28453);const l={},c="HogQL \u8868\u8fbe\u5f0f\u6307\u5357",t={},h=[{value:"\u8868\u8fbe\u5f0f\u6982\u8ff0",id:"\u8868\u8fbe\u5f0f\u6982\u8ff0",level:2},{value:"\u5e38\u7528\u51fd\u6570",id:"\u5e38\u7528\u51fd\u6570",level:2},{value:"1. \u6bd4\u8f83\u51fd\u6570",id:"1-\u6bd4\u8f83\u51fd\u6570",level:3},{value:"2. \u805a\u5408\u51fd\u6570",id:"2-\u805a\u5408\u51fd\u6570",level:3},{value:"3. \u5b57\u7b26\u4e32\u51fd\u6570",id:"3-\u5b57\u7b26\u4e32\u51fd\u6570",level:3},{value:"4. \u65e5\u671f\u51fd\u6570",id:"4-\u65e5\u671f\u51fd\u6570",level:3},{value:"\u5b9e\u7528\u793a\u4f8b",id:"\u5b9e\u7528\u793a\u4f8b",level:2},{value:"1. \u7528\u6237\u5206\u7ec4",id:"1-\u7528\u6237\u5206\u7ec4",level:3},{value:"2. URL \u5206\u6790",id:"2-url-\u5206\u6790",level:3},{value:"3. \u65f6\u95f4\u6bb5\u5206\u6790",id:"3-\u65f6\u95f4\u6bb5\u5206\u6790",level:3},{value:"4. \u590d\u5408\u6761\u4ef6\u8fc7\u6ee4",id:"4-\u590d\u5408\u6761\u4ef6\u8fc7\u6ee4",level:3},{value:"5. \u6570\u636e\u8f6c\u6362",id:"5-\u6570\u636e\u8f6c\u6362",level:3},{value:"\u8c03\u8bd5\u6280\u5de7",id:"\u8c03\u8bd5\u6280\u5de7",level:2}];function o(e){const d={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.header,{children:(0,s.jsx)(d.h1,{id:"hogql-\u8868\u8fbe\u5f0f\u6307\u5357",children:"HogQL \u8868\u8fbe\u5f0f\u6307\u5357"})}),"\n",(0,s.jsx)(d.h2,{id:"\u8868\u8fbe\u5f0f\u6982\u8ff0",children:"\u8868\u8fbe\u5f0f\u6982\u8ff0"}),"\n",(0,s.jsx)(d.p,{children:"HogQL \u8868\u8fbe\u5f0f\u662f\u4e00\u79cd\u5f3a\u5927\u7684\u6570\u636e\u8bbf\u95ee\u548c\u5904\u7406\u5de5\u5177\uff0c\u5b83\u5141\u8bb8\u60a8\u76f4\u63a5\u8bbf\u95ee\u3001\u4fee\u6539\u548c\u805a\u5408\u6570\u636e\u3002\u8fd9\u4e9b\u8868\u8fbe\u5f0f\u53ef\u4ee5\u5728 PostHog \u7684\u591a\u4e2a\u529f\u80fd\u4e2d\u4f7f\u7528\uff0c\u5305\u62ec\u8fc7\u6ee4\u5668\u3001\u8d8b\u52bf\u5206\u6790\u3001\u6570\u636e\u5206\u7ec4\u7b49\u3002"}),"\n",(0,s.jsx)(d.h2,{id:"\u5e38\u7528\u51fd\u6570",children:"\u5e38\u7528\u51fd\u6570"}),"\n",(0,s.jsx)(d.h3,{id:"1-\u6bd4\u8f83\u51fd\u6570",children:"1. \u6bd4\u8f83\u51fd\u6570"}),"\n",(0,s.jsxs)(d.table,{children:[(0,s.jsx)(d.thead,{children:(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.th,{children:"\u51fd\u6570"}),(0,s.jsx)(d.th,{children:"\u8bf4\u660e"}),(0,s.jsx)(d.th,{children:"\u793a\u4f8b"})]})}),(0,s.jsxs)(d.tbody,{children:[(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"if(\u6761\u4ef6, \u771f\u503c, \u5047\u503c)"})}),(0,s.jsx)(d.td,{children:"\u6761\u4ef6\u5224\u65ad"}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"if(properties.$os == 'iOS', '\u82f9\u679c', '\u5176\u4ed6')"})})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"multiIf(\u6761\u4ef61, \u503c1, \u6761\u4ef62, \u503c2, ..., \u9ed8\u8ba4\u503c)"})}),(0,s.jsx)(d.td,{children:"\u591a\u91cd\u6761\u4ef6\u5224\u65ad"}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"multiIf(properties.$os == 'iOS', '\u82f9\u679c', properties.$os == 'Android', '\u5b89\u5353', '\u5176\u4ed6')"})})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"in(\u503c, \u96c6\u5408)"})}),(0,s.jsx)(d.td,{children:"\u68c0\u67e5\u503c\u662f\u5426\u5728\u96c6\u5408\u4e2d"}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"in(properties.$browser, ['Chrome', 'Firefox'])"})})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"match(\u503c, \u6b63\u5219\u8868\u8fbe\u5f0f)"})}),(0,s.jsx)(d.td,{children:"\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d"}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"match(properties.$current_url, '^/blog/')"})})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"like"})}),(0,s.jsx)(d.td,{children:"\u6a21\u5f0f\u5339\u914d"}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"properties.$current_url like '%/blog%'"})})]})]})]}),"\n",(0,s.jsx)(d.h3,{id:"2-\u805a\u5408\u51fd\u6570",children:"2. \u805a\u5408\u51fd\u6570"}),"\n",(0,s.jsxs)(d.table,{children:[(0,s.jsx)(d.thead,{children:(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.th,{children:"\u51fd\u6570"}),(0,s.jsx)(d.th,{children:"\u8bf4\u660e"}),(0,s.jsx)(d.th,{children:"\u793a\u4f8b"})]})}),(0,s.jsxs)(d.tbody,{children:[(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"count"})}),(0,s.jsx)(d.td,{children:"\u8ba1\u6570"}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"count()"})})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"count(distinct)"})}),(0,s.jsx)(d.td,{children:"\u53bb\u91cd\u8ba1\u6570"}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"count(distinct person_id)"})})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"uniq"})}),(0,s.jsx)(d.td,{children:"\u8fd1\u4f3c\u53bb\u91cd\u8ba1\u6570"}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"uniq(person_id)"})})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"sum"})}),(0,s.jsx)(d.td,{children:"\u6c42\u548c"}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"sum(properties.$value)"})})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"avg"})}),(0,s.jsx)(d.td,{children:"\u5e73\u5747\u503c"}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"avg(properties.$value)"})})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"median"})}),(0,s.jsx)(d.td,{children:"\u4e2d\u4f4d\u6570"}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"median(properties.$value)"})})]})]})]}),"\n",(0,s.jsx)(d.h3,{id:"3-\u5b57\u7b26\u4e32\u51fd\u6570",children:"3. \u5b57\u7b26\u4e32\u51fd\u6570"}),"\n",(0,s.jsxs)(d.table,{children:[(0,s.jsx)(d.thead,{children:(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.th,{children:"\u51fd\u6570"}),(0,s.jsx)(d.th,{children:"\u8bf4\u660e"}),(0,s.jsx)(d.th,{children:"\u793a\u4f8b"})]})}),(0,s.jsxs)(d.tbody,{children:[(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"extract(\u5b57\u7b26\u4e32, \u6a21\u5f0f)"})}),(0,s.jsx)(d.td,{children:"\u63d0\u53d6\u5339\u914d\u5185\u5bb9"}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"extract(properties.$current_url, 'ref=([^&]*)')"})})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"concat(\u5b57\u7b26\u4e321, \u5b57\u7b26\u4e322, ...)"})}),(0,s.jsx)(d.td,{children:"\u5b57\u7b26\u4e32\u8fde\u63a5"}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"concat(person.properties.$name, ' - ', properties.$browser)"})})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"splitByChar(\u5206\u9694\u7b26, \u5b57\u7b26\u4e32)"})}),(0,s.jsx)(d.td,{children:"\u5b57\u7b26\u4e32\u5206\u5272"}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"splitByChar(',', properties.tags)"})})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"replaceOne(\u5b57\u7b26\u4e32, \u67e5\u627e, \u66ff\u6362)"})}),(0,s.jsx)(d.td,{children:"\u66ff\u6362\u7b2c\u4e00\u4e2a\u5339\u914d"}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"replaceOne(properties.$current_url, 'https://', '')"})})]})]})]}),"\n",(0,s.jsx)(d.h3,{id:"4-\u65e5\u671f\u51fd\u6570",children:"4. \u65e5\u671f\u51fd\u6570"}),"\n",(0,s.jsxs)(d.table,{children:[(0,s.jsx)(d.thead,{children:(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.th,{children:"\u51fd\u6570"}),(0,s.jsx)(d.th,{children:"\u8bf4\u660e"}),(0,s.jsx)(d.th,{children:"\u793a\u4f8b"})]})}),(0,s.jsxs)(d.tbody,{children:[(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"dateDiff('\u5355\u4f4d', \u5f00\u59cb\u65e5\u671f, \u7ed3\u675f\u65e5\u671f)"})}),(0,s.jsx)(d.td,{children:"\u8ba1\u7b97\u65e5\u671f\u5dee"}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"dateDiff('day', person.created_at, now())"})})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"toHour(timestamp)"})}),(0,s.jsx)(d.td,{children:"\u63d0\u53d6\u5c0f\u65f6"}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"toHour(timestamp)"})})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"now()"})}),(0,s.jsx)(d.td,{children:"\u5f53\u524d\u65f6\u95f4"}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"now()"})})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"today()"})}),(0,s.jsx)(d.td,{children:"\u4eca\u5929\u65e5\u671f"}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"today()"})})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"interval"})}),(0,s.jsx)(d.td,{children:"\u65f6\u95f4\u95f4\u9694"}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"now() - interval 7 day"})})]})]})]}),"\n",(0,s.jsx)(d.h2,{id:"\u5b9e\u7528\u793a\u4f8b",children:"\u5b9e\u7528\u793a\u4f8b"}),"\n",(0,s.jsx)(d.h3,{id:"1-\u7528\u6237\u5206\u7ec4",children:"1. \u7528\u6237\u5206\u7ec4"}),"\n",(0,s.jsx)(d.pre,{children:(0,s.jsx)(d.code,{className:"language-sql",children:"multiIf(\n    properties.$device_type == 'Desktop', '\u684c\u9762\u7aef',\n    properties.$os == 'iOS', 'iOS\u8bbe\u5907',\n    properties.$os == 'Android', '\u5b89\u5353\u8bbe\u5907',\n    '\u5176\u4ed6'\n)\n"})}),"\n",(0,s.jsx)(d.h3,{id:"2-url-\u5206\u6790",children:"2. URL \u5206\u6790"}),"\n",(0,s.jsx)(d.pre,{children:(0,s.jsx)(d.code,{className:"language-sql",children:"extract(properties.$current_url, 'utm_source=([^&]*)')\n"})}),"\n",(0,s.jsx)(d.h3,{id:"3-\u65f6\u95f4\u6bb5\u5206\u6790",children:"3. \u65f6\u95f4\u6bb5\u5206\u6790"}),"\n",(0,s.jsx)(d.pre,{children:(0,s.jsx)(d.code,{className:"language-sql",children:"multiIf(\n    toHour(timestamp) < 6, '\u51cc\u6668',\n    toHour(timestamp) < 12, '\u4e0a\u5348',\n    toHour(timestamp) < 18, '\u4e0b\u5348',\n    '\u665a\u4e0a'\n)\n"})}),"\n",(0,s.jsx)(d.h3,{id:"4-\u590d\u5408\u6761\u4ef6\u8fc7\u6ee4",children:"4. \u590d\u5408\u6761\u4ef6\u8fc7\u6ee4"}),"\n",(0,s.jsx)(d.pre,{children:(0,s.jsx)(d.code,{className:"language-sql",children:"properties.$browser = 'Chrome' \nAND dateDiff('day', timestamp, now()) <= 7\nAND person.properties.is_active = true\n"})}),"\n",(0,s.jsx)(d.h3,{id:"5-\u6570\u636e\u8f6c\u6362",children:"5. \u6570\u636e\u8f6c\u6362"}),"\n",(0,s.jsx)(d.pre,{children:(0,s.jsx)(d.code,{className:"language-sql",children:"toString(properties.$value)\ntoFloat(properties.$amount)\ntoDate(properties.$signup_date)\n"})}),"\n",(0,s.jsx)(d.h2,{id:"\u8c03\u8bd5\u6280\u5de7",children:"\u8c03\u8bd5\u6280\u5de7"}),"\n",(0,s.jsxs)(d.ol,{children:["\n",(0,s.jsxs)(d.li,{children:["\n",(0,s.jsxs)(d.p,{children:[(0,s.jsx)(d.strong,{children:"\u5206\u6b65\u8c03\u8bd5"}),"\uff1a"]}),"\n",(0,s.jsxs)(d.ul,{children:["\n",(0,s.jsx)(d.li,{children:"\u5c06\u590d\u6742\u8868\u8fbe\u5f0f\u62c6\u5206\u4e3a\u5c0f\u90e8\u5206"}),"\n",(0,s.jsx)(d.li,{children:"\u4f7f\u7528\u8d8b\u52bf\u8868\u89c6\u56fe\u67e5\u770b\u4e2d\u95f4\u7ed3\u679c"}),"\n",(0,s.jsx)(d.li,{children:"\u9a8c\u8bc1\u6570\u636e\u7c7b\u578b\u8f6c\u6362\u662f\u5426\u6b63\u786e"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(d.li,{children:["\n",(0,s.jsxs)(d.p,{children:[(0,s.jsx)(d.strong,{children:"\u5e38\u89c1\u95ee\u9898"}),"\uff1a"]}),"\n",(0,s.jsxs)(d.ul,{children:["\n",(0,s.jsxs)(d.li,{children:["\u68c0\u67e5\u5c5e\u6027\u540d\u79f0\u662f\u5426\u6b63\u786e\uff08\u6ce8\u610f ",(0,s.jsx)(d.code,{children:"$"})," \u524d\u7f00\uff09"]}),"\n",(0,s.jsx)(d.li,{children:"\u9a8c\u8bc1\u65e5\u671f\u683c\u5f0f\u662f\u5426\u7b26\u5408\u8981\u6c42"}),"\n",(0,s.jsx)(d.li,{children:"\u786e\u4fdd\u805a\u5408\u51fd\u6570\u4f7f\u7528\u6b63\u786e"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(d.li,{children:["\n",(0,s.jsxs)(d.p,{children:[(0,s.jsx)(d.strong,{children:"\u6027\u80fd\u4f18\u5316"}),"\uff1a"]}),"\n",(0,s.jsxs)(d.ul,{children:["\n",(0,s.jsx)(d.li,{children:"\u4f7f\u7528\u9002\u5f53\u7684\u7d22\u5f15\u5b57\u6bb5"}),"\n",(0,s.jsx)(d.li,{children:"\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u7c7b\u578b\u8f6c\u6362"}),"\n",(0,s.jsx)(d.li,{children:"\u5408\u7406\u4f7f\u7528\u805a\u5408\u51fd\u6570"}),"\n"]}),"\n"]}),"\n"]})]})}function x(e={}){const{wrapper:d}={...(0,i.R)(),...e.components};return d?(0,s.jsx)(d,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},28453:(e,d,r)=>{r.d(d,{R:()=>l,x:()=>c});var n=r(96540);const s={},i=n.createContext(s);function l(e){const d=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(d):{...d,...e}}),[d,e])}function c(e){let d;return d=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),n.createElement(i.Provider,{value:d},e.children)}}}]);