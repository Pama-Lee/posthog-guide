"use strict";(self.webpackChunkposthog_guide=self.webpackChunkposthog_guide||[]).push([[7334],{59500:(e,n,t)=>{t.r(n),t.d(n,{default:()=>u});var s=t(96540),i=t(51410);const o={container:"container_iEyi",title:"title_YeNm",form:"form_h9FU",formGroup:"formGroup_DAqj",capabilities:"capabilities_PhsT",capabilityGrid:"capabilityGrid_Lgv9",capabilityCard:"capabilityCard_jZ51",selected:"selected_jPoU",generateButton:"generateButton_lhnm"};var l=t(71710),a=t.n(l),r=t(4213),c=t(74848);const d=[{id:"processEvent",name:"\u4e8b\u4ef6\u5904\u7406",description:"\u5904\u7406\u548c\u8f6c\u6362\u4e8b\u4ef6\u6570\u636e",code:"\nexport async function processEvent(event) {\n    // \u5728\u6b64\u5904\u7406\u4e8b\u4ef6\n    return event\n}"},{id:"onEvent",name:"\u4e8b\u4ef6\u54cd\u5e94",description:"\u54cd\u5e94\u4e8b\u4ef6\u5e76\u6267\u884c\u64cd\u4f5c",code:"\nexport async function onEvent(event) {\n    // \u5728\u6b64\u54cd\u5e94\u4e8b\u4ef6\n}"},{id:"scheduledTask",name:"\u5b9a\u65f6\u4efb\u52a1",description:"\u6267\u884c\u5b9a\u671f\u4efb\u52a1",code:"\nexport const jobs = {\n    runDaily: {\n        name: 'daily-task',\n        type: 'schedule',\n        exec: async () => {\n            // \u5728\u6b64\u6267\u884c\u5b9a\u65f6\u4efb\u52a1\n        }\n    }\n}"},{id:"webhook",name:"Webhook\u5904\u7406",description:"\u5904\u7406\u548c\u53d1\u9001Webhook",code:"\nexport function composeWebhook(event) {\n    return {\n        url: 'https://your-webhook-url',\n        headers: {},\n        payload: event\n    }\n}"},{id:"frontend",name:"\u524d\u7aef\u7ec4\u4ef6",description:"\u6dfb\u52a0\u81ea\u5b9a\u4e49UI\u7ec4\u4ef6",code:"\nexport function setupPlugin({ config }) {\n    // \u524d\u7aef\u521d\u59cb\u5316\u4ee3\u7801\n}\n\nexport function teardownPlugin() {\n    // \u6e05\u7406\u4ee3\u7801\n}"}];function p(){const[e,n]=(0,s.useState)({name:"",description:"",author:"",url:"",version:"0.1.0",selectedCapabilities:[]}),t=e=>{const{name:t,value:s}=e.target;n((e=>({...e,[t]:s})))};return(0,c.jsxs)("div",{className:o.container,children:[(0,c.jsx)("h1",{className:o.title,children:"PostHog \u63d2\u4ef6\u5f00\u53d1\u5305\u751f\u6210\u5668"}),(0,c.jsxs)("div",{className:o.form,children:[(0,c.jsxs)("div",{className:o.formGroup,children:[(0,c.jsx)("label",{children:"\u63d2\u4ef6\u540d\u79f0"}),(0,c.jsx)("input",{type:"text",name:"name",value:e.name,onChange:t,placeholder:"\u4f8b\u5982: My Awesome Plugin"})]}),(0,c.jsxs)("div",{className:o.formGroup,children:[(0,c.jsx)("label",{children:"\u63cf\u8ff0"}),(0,c.jsx)("textarea",{name:"description",value:e.description,onChange:t,placeholder:"\u63cf\u8ff0\u4f60\u7684\u63d2\u4ef6\u529f\u80fd..."})]}),(0,c.jsxs)("div",{className:o.formGroup,children:[(0,c.jsx)("label",{children:"\u4f5c\u8005"}),(0,c.jsx)("input",{type:"text",name:"author",value:e.author,onChange:t,placeholder:"\u4f60\u7684\u540d\u5b57"})]}),(0,c.jsxs)("div",{className:o.formGroup,children:[(0,c.jsx)("label",{children:"\u9879\u76eeURL"}),(0,c.jsx)("input",{type:"text",name:"url",value:e.url,onChange:t,placeholder:"https://github.com/your-username/your-plugin"})]}),(0,c.jsxs)("div",{className:o.formGroup,children:[(0,c.jsx)("label",{children:"\u7248\u672c"}),(0,c.jsx)("input",{type:"text",name:"version",value:e.version,onChange:t,placeholder:"0.1.0"})]}),(0,c.jsxs)("div",{className:o.capabilities,children:[(0,c.jsx)("h3",{children:"\u9009\u62e9\u63d2\u4ef6\u80fd\u529b"}),(0,c.jsx)("div",{className:o.capabilityGrid,children:d.map((t=>(0,c.jsxs)("div",{className:`${o.capabilityCard} ${e.selectedCapabilities.includes(t.id)?o.selected:""}`,onClick:()=>{return e=t.id,void n((n=>{const t=n.selectedCapabilities.includes(e)?n.selectedCapabilities.filter((n=>n!==e)):[...n.selectedCapabilities,e];return{...n,selectedCapabilities:t}}));var e},children:[(0,c.jsx)("h4",{children:t.name}),(0,c.jsx)("p",{children:t.description})]},t.id)))})]}),(0,c.jsx)("button",{className:o.generateButton,onClick:async()=>{const n=new(a()),t={name:e.name,description:e.description,url:e.url,version:e.version,main:"dist/index.js",config:{frontend:e.selectedCapabilities.includes("frontend"),backend:!0,example_string:{name:"\u793a\u4f8b\u6587\u672c",type:"string",default:"",required:!1,description:"\u8fd9\u662f\u4e00\u4e2a\u793a\u4f8b\u914d\u7f6e\u9879"},example_number:{name:"\u793a\u4f8b\u6570\u5b57",type:"number",default:0,required:!1,description:"\u8fd9\u662f\u4e00\u4e2a\u6570\u5b57\u7c7b\u578b\u7684\u914d\u7f6e\u9879"},example_boolean:{name:"\u793a\u4f8b\u5f00\u5173",type:"boolean",default:!1,required:!1,description:"\u8fd9\u662f\u4e00\u4e2a\u5e03\u5c14\u7c7b\u578b\u7684\u914d\u7f6e\u9879"}},capabilities:{methods:e.selectedCapabilities,jobs:e.selectedCapabilities.includes("scheduledTask")?["runDaily"]:[],scheduled_tasks:e.selectedCapabilities.includes("scheduledTask")?["runDaily"]:[]}};n.file("plugin.json",JSON.stringify(t,null,2));const s=`# ${e.name}\n\n${e.description}\n\n## \u529f\u80fd\u7279\u6027\n\n${d.filter((n=>e.selectedCapabilities.includes(n.id))).map((e=>`- ${e.name}: ${e.description}`)).join("\n")}\n\n## \u9879\u76ee\u7ed3\u6784\n\n\`\`\`\n${e.name.toLowerCase().replace(/\s+/g,"-")}/\n\u251c\u2500\u2500 src/                    # \u6e90\u4ee3\u7801\u76ee\u5f55\n\u2502   \u251c\u2500\u2500 index.ts           # \u63d2\u4ef6\u4e3b\u5165\u53e3\u6587\u4ef6\n\u2502   \u2514\u2500\u2500 __tests__/         # \u6d4b\u8bd5\u6587\u4ef6\u76ee\u5f55\n\u2502       \u2514\u2500\u2500 index.test.ts  # \u5355\u5143\u6d4b\u8bd5\u6587\u4ef6\n\u251c\u2500\u2500 dist/                  # \u7f16\u8bd1\u8f93\u51fa\u76ee\u5f55\n\u251c\u2500\u2500 plugin.json           # \u63d2\u4ef6\u914d\u7f6e\u6587\u4ef6\n\u251c\u2500\u2500 package.json         # \u9879\u76ee\u4f9d\u8d56\u914d\u7f6e\n\u251c\u2500\u2500 tsconfig.json       # TypeScript \u914d\u7f6e\n\u2514\u2500\u2500 README.md          # \u9879\u76ee\u8bf4\u660e\u6587\u6863\n\`\`\`\n\n## \u6587\u4ef6\u8bf4\u660e\n\n### plugin.json\n\u63d2\u4ef6\u7684\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6\uff0c\u5b9a\u4e49\u4e86\u63d2\u4ef6\u7684\u57fa\u672c\u4fe1\u606f\u3001\u914d\u7f6e\u9879\u548c\u80fd\u529b\u3002\u5305\u542b\uff1a\n- \u63d2\u4ef6\u540d\u79f0\u3001\u63cf\u8ff0\u3001\u7248\u672c\u7b49\u57fa\u672c\u4fe1\u606f\n- \u914d\u7f6e\u9879\u5b9a\u4e49\uff08\u652f\u6301string\u3001number\u3001boolean\u7b49\u7c7b\u578b\uff09\n- \u63d2\u4ef6\u80fd\u529b\u58f0\u660e\uff08methods\u3001jobs\u3001scheduled_tasks\u7b49\uff09\n\n### src/index.ts\n\u63d2\u4ef6\u7684\u4e3b\u8981\u5b9e\u73b0\u6587\u4ef6\uff0c\u5305\u542b\uff1a\n${e.selectedCapabilities.map((e=>`- ${d.find((n=>n.id===e)).name}\u7684\u5b9e\u73b0\u4ee3\u7801`)).join("\n")}\n\n### __tests__/index.test.ts\n\u5355\u5143\u6d4b\u8bd5\u6587\u4ef6\uff0c\u7528\u4e8e\u6d4b\u8bd5\u63d2\u4ef6\u529f\u80fd\u7684\u6b63\u786e\u6027\u3002\u5efa\u8bae\u4e3a\u6bcf\u4e2a\u4e3b\u8981\u529f\u80fd\u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b\u3002\n\n### package.json\n\u9879\u76ee\u4f9d\u8d56\u914d\u7f6e\u6587\u4ef6\uff0c\u5305\u542b\uff1a\n- \u9879\u76ee\u5143\u4fe1\u606f\n- \u4f9d\u8d56\u5305\u5217\u8868\n- \u6784\u5efa\u548c\u6d4b\u8bd5\u811a\u672c\n\n### tsconfig.json\nTypeScript \u914d\u7f6e\u6587\u4ef6\uff0c\u5b9a\u4e49\u4e86\u7f16\u8bd1\u9009\u9879\u548c\u9879\u76ee\u7ed3\u6784\u3002\n\n## \u5f00\u53d1\u6307\u5357\n\n### \u73af\u5883\u51c6\u5907\n1. \u786e\u4fdd\u5df2\u5b89\u88c5 Node.js (>= 14.x)\n2. \u514b\u9686\u6b64\u4ed3\u5e93\n3. \u5b89\u88c5\u4f9d\u8d56\uff1a\n   \`\`\`bash\n   npm install\n   \`\`\`\n\n### \u5f00\u53d1\u6d41\u7a0b\n1. \u4fee\u6539 src/index.ts \u5b9e\u73b0\u63d2\u4ef6\u529f\u80fd\n2. \u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b\n3. \u8fd0\u884c\u6d4b\u8bd5\uff1a\n   \`\`\`bash\n   npm test\n   \`\`\`\n4. \u6784\u5efa\u63d2\u4ef6\uff1a\n   \`\`\`bash\n   npm run build\n   \`\`\`\n\n### \u914d\u7f6e\u8bf4\u660e\n\u5728 plugin.json \u4e2d\u53ef\u4ee5\u5b9a\u4e49\u63d2\u4ef6\u7684\u914d\u7f6e\u9879\uff1a\n\`\`\`json\n{\n  "name": "\u914d\u7f6e\u9879\u540d\u79f0",\n  "type": "\u914d\u7f6e\u9879\u7c7b\u578b",\n  "default": "\u9ed8\u8ba4\u503c",\n  "required": false,\n  "description": "\u914d\u7f6e\u9879\u8bf4\u660e"\n}\n\`\`\`\n\n### \u8c03\u8bd5\u6280\u5de7\n1. \u4f7f\u7528 console.log \u8f93\u51fa\u8c03\u8bd5\u4fe1\u606f\n2. \u67e5\u770b PostHog \u540e\u53f0\u7684\u63d2\u4ef6\u65e5\u5fd7\n3. \u4f7f\u7528 Jest \u7684\u8c03\u8bd5\u529f\u80fd\u8fdb\u884c\u65ad\u70b9\u8c03\u8bd5\n\n## \u90e8\u7f72\n\n1. \u6784\u5efa\u63d2\u4ef6\uff1a\n   \`\`\`bash\n   npm run build\n   \`\`\`\n2. \u5c06\u63d2\u4ef6\u4e0a\u4f20\u5230 PostHog \u540e\u53f0\n3. \u914d\u7f6e\u63d2\u4ef6\u53c2\u6570\n4. \u542f\u7528\u63d2\u4ef6\n\n## \u4f5c\u8005\n\n${e.author}\n\n## \u8bb8\u53ef\u8bc1\n\nMIT\n`;n.file("README.md",s);const i={name:e.name.toLowerCase().replace(/\s+/g,"-"),version:e.version,description:e.description,author:e.author,license:"MIT",scripts:{build:"tsc",test:"jest","build:watch":"tsc --watch","test:watch":"jest --watch"},dependencies:{"@posthog/plugin-scaffold":"^1.0.0","@posthog/plugin-contrib":"^1.0.0"},devDependencies:{typescript:"^4.5.0","@types/node":"^16.0.0",jest:"^27.0.0","@types/jest":"^27.0.0","ts-jest":"^27.0.0","@typescript-eslint/parser":"^5.0.0","@typescript-eslint/eslint-plugin":"^5.0.0",eslint:"^8.0.0","eslint-config-prettier":"^8.0.0",prettier:"^2.0.0"}};n.file("package.json",JSON.stringify(i,null,2));n.file("tsconfig.json",JSON.stringify({compilerOptions:{target:"es2019",module:"commonjs",lib:["es2019"],declaration:!0,strict:!0,esModuleInterop:!0,skipLibCheck:!0,forceConsistentCasingInFileNames:!0,outDir:"dist",rootDir:"src"},include:["src/**/*"],exclude:["node_modules","**/*.test.ts"]},null,2));let o="import { Plugin, PluginEvent, PluginMeta } from '@posthog/plugin-scaffold'\n\n";d.filter((n=>e.selectedCapabilities.includes(n.id))).forEach((e=>{o+=e.code+"\n\n"})),n.file("src/index.ts",o);const l=`import { Plugin, PluginEvent, PluginMeta } from '@posthog/plugin-scaffold'\n\ndescribe('${e.name}', () => {\n    let plugin: Plugin\n    let event: PluginEvent\n\n    beforeEach(() => {\n        plugin = new Plugin()\n        event = {\n            event: 'test_event',\n            properties: {},\n            timestamp: new Date().toISOString(),\n            team_id: 1,\n            distinct_id: 'test_user',\n            uuid: 'test_uuid'\n        }\n    })\n\n    ${e.selectedCapabilities.includes("processEvent")?"\n    test('processEvent modifies event correctly', async () => {\n        const processedEvent = await plugin.processEvent(event)\n        expect(processedEvent).toBeDefined()\n    })":""}\n\n    ${e.selectedCapabilities.includes("onEvent")?"\n    test('onEvent handles event correctly', async () => {\n        await plugin.onEvent(event)\n        // Add your assertions here\n    })":""}\n\n    ${e.selectedCapabilities.includes("scheduledTask")?"\n    test('scheduled task executes correctly', async () => {\n        const task = plugin.jobs.runDaily\n        expect(task).toBeDefined()\n        await task.exec()\n        // Add your assertions here\n    })":""}\n})\n`;n.file("src/__tests__/index.test.ts",l);n.file(".gitignore","# Dependencies\nnode_modules/\n\n# Build\ndist/\n\n# Tests\ncoverage/\n\n# IDE\n.idea/\n.vscode/\n*.swp\n*.swo\n\n# OS\n.DS_Store\nThumbs.db\n\n# Logs\n*.log\nnpm-debug.log*\nyarn-debug.log*\nyarn-error.log*\n\n# Environment\n.env\n.env.local\n.env.*.local\n");n.file(".prettierrc",JSON.stringify({semi:!1,singleQuote:!0,tabWidth:4,trailingComma:"es5",printWidth:100},null,2));n.file(".eslintrc.js","module.exports = {\n    parser: '@typescript-eslint/parser',\n    extends: [\n        'plugin:@typescript-eslint/recommended',\n        'prettier'\n    ],\n    parserOptions: {\n        ecmaVersion: 2020,\n        sourceType: 'module'\n    },\n    rules: {\n        // \u81ea\u5b9a\u4e49\u89c4\u5219\n    }\n}");n.file("jest.config.js","module.exports = {\n    preset: 'ts-jest',\n    testEnvironment: 'node',\n    testMatch: ['**/__tests__/**/*.test.ts'],\n    collectCoverage: true,\n    coverageDirectory: 'coverage',\n    coverageReporters: ['text', 'lcov'],\n    coverageThreshold: {\n        global: {\n            branches: 80,\n            functions: 80,\n            lines: 80,\n            statements: 80\n        }\n    }\n}");const c=await n.generateAsync({type:"blob"});(0,r.saveAs)(c,`${e.name.toLowerCase().replace(/\s+/g,"-")}-plugin.zip`)},disabled:!e.name||0===e.selectedCapabilities.length,children:"\u751f\u6210\u63d2\u4ef6\u5f00\u53d1\u5305"})]})]})}function u(){return(0,c.jsx)(i.A,{title:"\u63d2\u4ef6\u5f00\u53d1\u5305\u751f\u6210\u5668",description:"\u751f\u6210 PostHog \u63d2\u4ef6\u5f00\u53d1\u8d77\u59cb\u5305",children:(0,c.jsx)("main",{children:(0,c.jsx)(p,{})})})}}}]);